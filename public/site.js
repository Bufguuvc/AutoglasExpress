function readJson(id){var el=document.getElementById(id);if(!el)return null;try{return JSON.parse(el.textContent.trim()||"null");}catch(e){console.error("Invalid JSON in #"+id,e);return null}}
function onceReady(fn){if(document.readyState==="complete"||document.readyState==="interactive"){setTimeout(fn,0)}else{document.addEventListener("DOMContentLoaded",fn)}}
function waitFor(selector,timeout){return new Promise(function(res){var done=false;var t=setTimeout(function(){if(!done){done=true;res(null)}},timeout||6000);var check=function(){var n=document.querySelector(selector);if(n){if(!done){done=true;clearTimeout(t);res(n)}}else{requestAnimationFrame(check)}};check()})}
function rewriteHeaderLogo(url){if(!url)return;var apply=function(){var img=document.querySelector("header img, nav img, img[alt*='logo' i], img[src*='logo'], img[class*='logo']");if(img){img.src=url;img.srcset="";return true}return false};if(!apply()){var mo=new MutationObserver(function(){if(apply()){mo.disconnect()}});mo.observe(document.documentElement,{childList:true,subtree:true})}}
function updateCarousel(list){if(!Array.isArray(list)||!list.length)return;var applied=false;var replaceImgs=function(root){var sel="section img, .carousel img, [class*='carousel'] img, [data-carousel] img";root.querySelectorAll(sel).forEach(function(img,i){if(list[i]){img.src=list[i];img.srcset="";applied=true}})};var root=document;replaceImgs(root);if(!applied){waitFor(".carousel, [data-carousel], section",4000).then(function(node){if(node){replaceImgs(document)}});var mo=new MutationObserver(function(muts){muts.forEach(function(m){m.addedNodes&&m.addedNodes.forEach(function(n){if(n.nodeType===1){var imgs=n.querySelectorAll&&n.querySelectorAll("img");if(imgs&&imgs.length){Array.from(imgs).forEach(function(img,i){var idx=i;var cur=document.querySelectorAll("img").length-1;var j=cur%list.length;if(list[j]){}})}}});replaceImgs(document)});mo.observe(document.documentElement,{childList:true,subtree:true})}}
onceReady(function(){var imgs=readJson("insurance-images");var map=readJson("image-rewrites")||{};updateCarousel(imgs);rewriteHeaderLogo(map.headerLogo)});
